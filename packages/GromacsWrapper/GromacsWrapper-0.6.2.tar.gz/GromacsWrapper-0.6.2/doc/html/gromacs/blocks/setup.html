<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>gromacs.setup – Setting up a Gromacs MD run &mdash; GromacsWrapper 0.6.1 documentation</title>
    
    <link rel="stylesheet" href="../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.6.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../_static/GromacsWrapper_logo_32x32.ico"/>
    <link rel="top" title="GromacsWrapper 0.6.1 documentation" href="../../index.html" />
    <link rel="up" title="Gromacs building blocks" href="../building_blocks.html" />
    <link rel="next" title="gromacs.scaling – Partial tempering" href="scaling.html" />
    <link rel="prev" title="gromacs.cbook – Gromacs Cook Book" href="cbook.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="scaling.html" title="gromacs.scaling – Partial tempering"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="cbook.html" title="gromacs.cbook – Gromacs Cook Book"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">GromacsWrapper 0.6.1 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../gromacs.html" >GromacsWrapper package</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="../building_blocks.html" accesskey="U">Gromacs building blocks</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/GromacsWrapper_logo_200x200.png" alt="Logo"/>
            </a></p>
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#"><code class="docutils literal"><span class="pre">gromacs.setup</span></code> &#8211; Setting up a Gromacs MD run</a><ul>
<li><a class="reference internal" href="#user-functions">User functions</a></li>
<li><a class="reference internal" href="#example">Example</a></li>
<li><a class="reference internal" href="#id1">User functions</a></li>
<li><a class="reference internal" href="#helper-functions">Helper functions</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="cbook.html"
                        title="previous chapter"><code class="docutils literal"><span class="pre">gromacs.cbook</span></code> &#8211; Gromacs Cook Book</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="scaling.html"
                        title="next chapter"><code class="docutils literal"><span class="pre">gromacs.scaling</span></code> &#8211; Partial tempering</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/gromacs/blocks/setup.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <span class="target" id="module-gromacs.setup"></span><div class="section" id="gromacs-setup-setting-up-a-gromacs-md-run">
<h1><a class="reference internal" href="#module-gromacs.setup" title="gromacs.setup"><code class="xref py py-mod docutils literal"><span class="pre">gromacs.setup</span></code></a> &#8211; Setting up a Gromacs MD run<a class="headerlink" href="#gromacs-setup-setting-up-a-gromacs-md-run" title="Permalink to this headline">¶</a></h1>
<p>Individual steps such as solvating a structure or energy minimization
are set up in individual directories. For energy minimization one
should supply appropriate mdp run input files; otherwise example
templates are used.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">You <strong>must</strong> check all simulation parameters for yourself. Do not rely on
any defaults provided here. The scripts provided here are provided under the
assumption that you know what you are doing and you just want to automate
the boring parts of the process.</p>
</div>
<div class="section" id="user-functions">
<h2>User functions<a class="headerlink" href="#user-functions" title="Permalink to this headline">¶</a></h2>
<p>The individual steps of setting up a simple MD simulation are broken down in a
sequence of functions that depend on the previous step(s):</p>
<blockquote>
<div><dl class="docutils">
<dt><a class="reference internal" href="#gromacs.setup.topology" title="gromacs.setup.topology"><code class="xref py py-func docutils literal"><span class="pre">topology()</span></code></a></dt>
<dd>generate initial topology file (limited functionality, might require
manual setup)</dd>
<dt><a class="reference internal" href="#gromacs.setup.solvate" title="gromacs.setup.solvate"><code class="xref py py-func docutils literal"><span class="pre">solvate()</span></code></a></dt>
<dd>solvate globular protein and add ions to neutralize</dd>
<dt><a class="reference internal" href="#gromacs.setup.energy_minimize" title="gromacs.setup.energy_minimize"><code class="xref py py-func docutils literal"><span class="pre">energy_minimize()</span></code></a></dt>
<dd>set up energy minimization and run it (using <code class="docutils literal"><span class="pre">mdrun_d</span></code>)</dd>
<dt><a class="reference internal" href="#gromacs.setup.em_schedule" title="gromacs.setup.em_schedule"><code class="xref py py-func docutils literal"><span class="pre">em_schedule()</span></code></a></dt>
<dd>set up and run multiple energy minimizations one after another (as an
alternative to the simple single energy minimization provided by
<a class="reference internal" href="#gromacs.setup.energy_minimize" title="gromacs.setup.energy_minimize"><code class="xref py py-func docutils literal"><span class="pre">energy_minimize()</span></code></a>)</dd>
<dt><a class="reference internal" href="#gromacs.setup.MD_restrained" title="gromacs.setup.MD_restrained"><code class="xref py py-func docutils literal"><span class="pre">MD_restrained()</span></code></a></dt>
<dd>set up restrained MD</dd>
<dt><a class="reference internal" href="#gromacs.setup.MD" title="gromacs.setup.MD"><code class="xref py py-func docutils literal"><span class="pre">MD()</span></code></a></dt>
<dd>set up equilibrium MD</dd>
</dl>
</div></blockquote>
<p>Each function uses its own working directory (set with the <code class="docutils literal"><span class="pre">dirname</span></code> keyword
argument, but it should be safe and convenient to use the defaults). Other
arguments assume the default locations so typically not much should have to be
set manually.</p>
<p>One can supply non-standard itp files in the topology directory. In
some cases one does not use the <a class="reference internal" href="#gromacs.setup.topology" title="gromacs.setup.topology"><code class="xref py py-func docutils literal"><span class="pre">topology()</span></code></a> function at all but
sets up the topology manually. In this case it is safest to call the
topology directory <code class="docutils literal"><span class="pre">top</span></code> and make sure that it contains all relevant
top, itp, and pdb files.</p>
</div>
<div class="section" id="example">
<h2>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h2>
<p>Run a single protein in a dodecahedral box of SPC water molecules and
use the GROMOS96 G43a1 force field. We start with the structure in
<code class="docutils literal"><span class="pre">protein.pdb</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gromacs.setup</span> <span class="k">import</span> <span class="o">*</span>
<span class="n">f1</span> <span class="o">=</span> <span class="n">topology</span><span class="p">(</span><span class="n">protein</span><span class="o">=</span><span class="s1">&#39;MyProtein&#39;</span><span class="p">,</span> <span class="n">struct</span><span class="o">=</span><span class="s1">&#39;protein.pdb&#39;</span><span class="p">,</span> <span class="n">ff</span><span class="o">=</span><span class="s1">&#39;G43a1&#39;</span><span class="p">,</span> <span class="n">water</span><span class="o">=</span><span class="s1">&#39;spc&#39;</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ignh</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Each function returns &#8220;interesting&#8221; new files in a dictionary in such
a away that it can often be used as input for the next function in the
chain (although in most cases one can get away with the defaults of
the keyword arguments):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">f2</span> <span class="o">=</span> <span class="n">solvate</span><span class="p">(</span><span class="o">**</span><span class="n">f1</span><span class="p">)</span>
<span class="n">f3</span> <span class="o">=</span> <span class="n">energy_minimize</span><span class="p">(</span><span class="o">**</span><span class="n">f2</span><span class="p">)</span>
</pre></div>
</div>
<p>Now prepare input for a MD run with restraints on the protein:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">MD_restrained</span><span class="p">(</span><span class="o">**</span><span class="n">f3</span><span class="p">)</span>
</pre></div>
</div>
<p>Use the files in the directory to run the simulation locally or on a
cluster. You can provide your own template for a queuing system
submission script; see the source code for details.</p>
<p>Once the restraint run has completed, use the last frame as input for
the equilibrium MD:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">MD</span><span class="p">(</span><span class="n">struct</span><span class="o">=</span><span class="s1">&#39;MD_POSRES/md.gro&#39;</span><span class="p">,</span> <span class="n">runtime</span><span class="o">=</span><span class="mi">1</span><span class="n">e5</span><span class="p">)</span>
</pre></div>
</div>
<p>Run the resulting tpr file on a cluster.</p>
</div>
<div class="section" id="id1">
<h2>User functions<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>The following functions are provided for the user:</p>
<dl class="function">
<dt id="gromacs.setup.topology">
<code class="descclassname">gromacs.setup.</code><code class="descname">topology</code><span class="sig-paren">(</span><em>struct=None</em>, <em>protein='protein'</em>, <em>top='system.top'</em>, <em>dirname='top'</em>, <em>posres='posres.itp'</em>, <em>**pdb2gmx_args</em><span class="sig-paren">)</span><a class="headerlink" href="#gromacs.setup.topology" title="Permalink to this definition">¶</a></dt>
<dd><p>Build Gromacs topology files from pdb.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Keywords:</th><td class="field-body"><dl class="first last docutils">
<dt><em>struct</em></dt>
<dd><p class="first last">input structure (<strong>required</strong>)</p>
</dd>
<dt><em>protein</em></dt>
<dd><p class="first last">name of the output files</p>
</dd>
<dt><em>top</em></dt>
<dd><p class="first last">name of the topology file</p>
</dd>
<dt><em>dirname</em></dt>
<dd><p class="first last">directory in which the new topology will be stored</p>
</dd>
<dt><em>pdb2gmxargs</em></dt>
<dd><p class="first last">arguments for <code class="docutils literal"><span class="pre">pdb2gmx</span></code> such as <code class="docutils literal"><span class="pre">ff</span></code>, <code class="docutils literal"><span class="pre">water</span></code>, ...</p>
</dd>
</dl>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">At the moment this function simply runs <code class="docutils literal"><span class="pre">pdb2gmx</span></code> and uses
the resulting topology file directly. If you want to create
more complicated topologies and maybe also use additional itp
files or make a protein itp file then you will have to do this
manually.</p>
</div>
</dd></dl>

<dl class="function">
<dt id="gromacs.setup.solvate">
<code class="descclassname">gromacs.setup.</code><code class="descname">solvate</code><span class="sig-paren">(</span><em>struct='top/protein.pdb'</em>, <em>top='top/system.top'</em>, <em>distance=0.9</em>, <em>boxtype='dodecahedron'</em>, <em>concentration=0</em>, <em>cation='NA'</em>, <em>anion='CL'</em>, <em>water='spc'</em>, <em>solvent_name='SOL'</em>, <em>with_membrane=False</em>, <em>ndx='main.ndx'</em>, <em>mainselection='&quot;Protein&quot;'</em>, <em>dirname='solvate'</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#gromacs.setup.solvate" title="Permalink to this definition">¶</a></dt>
<dd><p>Put protein into box, add water, add counter-ions.</p>
<p>Currently this really only supports solutes in water. If you need
to embedd a protein in a membrane then you will require more
sophisticated approaches.</p>
<p>However, you <em>can</em> supply a protein already inserted in a
bilayer. In this case you will probably want to set <em>distance</em> =
<code class="docutils literal"><span class="pre">None</span></code> and also enable <em>with_membrane</em> = <code class="docutils literal"><span class="pre">True</span></code> (using extra
big vdw radii for typical lipids).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The defaults are suitable for solvating a globular
protein in a fairly tight (increase <em>distance</em>!) dodecahedral
box.</p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><dl class="first last docutils">
<dt><em>struct</em></dt>
 <span class="classifier-delimiter">:</span> <span class="classifier">filename</span><dd><p class="first last">pdb or gro input structure</p>
</dd>
<dt><em>top</em></dt>
 <span class="classifier-delimiter">:</span> <span class="classifier">filename</span><dd><p class="first last">Gromacs topology</p>
</dd>
<dt><em>distance</em></dt>
 <span class="classifier-delimiter">:</span> <span class="classifier">float</span><dd><p class="first last">When solvating with water, make the box big enough so that
at least <em>distance</em> nm water are between the solute <em>struct</em>
and the box boundary.
Set <em>boxtype</em>  to <code class="docutils literal"><span class="pre">None</span></code> in order to use a box size in the input
file (gro or pdb).</p>
</dd>
<dt><em>boxtype</em> or <em>bt</em>: string</dt>
<dd><p class="first">Any of the box types supported by <code class="xref py py-class docutils literal"><span class="pre">Editconf</span></code>
(triclinic, cubic, dodecahedron, octahedron). Set the box dimensions
either with <em>distance</em> or the <em>box</em> and <em>angle</em> keywords.</p>
<p>If set to <code class="docutils literal"><span class="pre">None</span></code> it will ignore <em>distance</em> and use the box
inside the <em>struct</em> file.</p>
<p class="last"><em>bt</em> overrides the value of <em>boxtype</em>.</p>
</dd>
<dt><em>box</em></dt>
<dd><p class="first last">List of three box lengths [A,B,C] that are used by <code class="xref py py-class docutils literal"><span class="pre">Editconf</span></code>
in combination with <em>boxtype</em> (<code class="docutils literal"><span class="pre">bt</span></code> in <strong class="program">editconf</strong>) and <em>angles</em>.
Setting <em>box</em> overrides <em>distance</em>.</p>
</dd>
<dt><em>angles</em></dt>
<dd><p class="first last">List of three angles (only necessary for triclinic boxes).</p>
</dd>
<dt><em>concentration</em></dt>
 <span class="classifier-delimiter">:</span> <span class="classifier">float</span><dd><p class="first last">Concentration of the free ions in mol/l. Note that counter
ions are added in excess of this concentration.</p>
</dd>
<dt><em>cation</em> and <em>anion</em></dt>
 <span class="classifier-delimiter">:</span> <span class="classifier">string</span><dd><p class="first last">Molecule names of the ions. This depends on the chosen force field.</p>
</dd>
<dt><em>water</em></dt>
 <span class="classifier-delimiter">:</span> <span class="classifier">string</span><dd><p class="first last">Name of the water model; one of &#8220;spc&#8221;, &#8220;spce&#8221;, &#8220;tip3p&#8221;,
&#8220;tip4p&#8221;. This should be appropriate for the chosen force
field. If an alternative solvent is required, simply supply the path to a box
with solvent molecules (used by <code class="xref py py-func docutils literal"><span class="pre">genbox()</span></code>&#8216;s  <em>cs</em> argument)
and also supply the molecule name via <em>solvent_name</em>.</p>
</dd>
<dt><em>solvent_name</em></dt>
<dd><p class="first last">Name of the molecules that make up the solvent (as set in the itp/top).
Typically needs to be changed when using non-standard/non-water solvents.
[&#8220;SOL&#8221;]</p>
</dd>
<dt><em>with_membrane</em></dt>
 <span class="classifier-delimiter">:</span> <span class="classifier">bool</span><dd><p class="first last"><code class="docutils literal"><span class="pre">True</span></code>: use special <code class="docutils literal"><span class="pre">vdwradii.dat</span></code> with 0.1 nm-increased radii on
lipids. Default is <code class="docutils literal"><span class="pre">False</span></code>.</p>
</dd>
<dt><em>ndx</em></dt>
 <span class="classifier-delimiter">:</span> <span class="classifier">filename</span><dd><p class="first last">How to name the index file that is produced by this function.</p>
</dd>
<dt><em>mainselection</em></dt>
 <span class="classifier-delimiter">:</span> <span class="classifier">string</span><dd><p class="first last">A string that is fed to <code class="xref py py-class docutils literal"><span class="pre">Make_ndx</span></code> and
which should select the solute.</p>
</dd>
<dt><em>dirname</em></dt>
 <span class="classifier-delimiter">:</span> <span class="classifier">directory name</span><dd><p class="first last">Name of the directory in which all files for the solvation stage are stored.</p>
</dd>
<dt><em>includes</em></dt>
<dd><p class="first last">List of additional directories to add to the mdp include path</p>
</dd>
<dt><em>kwargs</em></dt>
<dd><p class="first last">Additional arguments are passed on to
<code class="xref py py-class docutils literal"><span class="pre">Editconf</span></code> or are interpreted as parameters to be
changed in the mdp file.</p>
</dd>
</dl>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="gromacs.setup.energy_minimize">
<code class="descclassname">gromacs.setup.</code><code class="descname">energy_minimize</code><span class="sig-paren">(</span><em>dirname='em'</em>, <em>mdp='/Volumes/Data/oliver/Biop/Projects/Methods/GromacsWrapper/gromacs/templates/em.mdp'</em>, <em>struct='solvate/ionized.gro'</em>, <em>top='top/system.top'</em>, <em>output='em.pdb'</em>, <em>deffnm='em'</em>, <em>mdrunner=None</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#gromacs.setup.energy_minimize" title="Permalink to this definition">¶</a></dt>
<dd><p>Energy minimize the system.</p>
<p>This sets up the system (creates run input files) and also runs
<code class="docutils literal"><span class="pre">mdrun_d</span></code>. Thus it can take a while.</p>
<p>Additional itp files should be in the same directory as the top file.</p>
<p>Many of the keyword arguments below already have sensible values.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Keywords:</th><td class="field-body"><dl class="first last docutils">
<dt><em>dirname</em></dt>
<dd><p class="first last">set up under directory dirname [em]</p>
</dd>
<dt><em>struct</em></dt>
<dd><p class="first last">input structure (gro, pdb, ...) [solvate/ionized.gro]</p>
</dd>
<dt><em>output</em></dt>
<dd><p class="first last">output structure (will be put under dirname) [em.pdb]</p>
</dd>
<dt><em>deffnm</em></dt>
<dd><p class="first last">default name for mdrun-related files [em]</p>
</dd>
<dt><em>top</em></dt>
<dd><p class="first last">topology file [top/system.top]</p>
</dd>
<dt><em>mdp</em></dt>
<dd><p class="first last">mdp file (or use the template) [templates/em.mdp]</p>
</dd>
<dt><em>includes</em></dt>
<dd><p class="first last">additional directories to search for itp files</p>
</dd>
<dt><em>mdrunner</em></dt>
<dd><p class="first last"><a class="reference internal" href="simulation.html#gromacs.run.MDrunner" title="gromacs.run.MDrunner"><code class="xref py py-class docutils literal"><span class="pre">gromacs.run.MDrunner</span></code></a> instance; by default we
just try <code class="xref py py-func docutils literal"><span class="pre">gromacs.mdrun_d()</span></code> and <code class="xref py py-func docutils literal"><span class="pre">gromacs.mdrun()</span></code> but a
MDrunner instance gives the user the ability to run mpi jobs
etc. [None]</p>
</dd>
<dt><em>kwargs</em></dt>
<dd><p class="first last">remaining key/value pairs that should be changed in the
template mdp file, eg <code class="docutils literal"><span class="pre">nstxtcout=250,</span> <span class="pre">nstfout=250</span></code>.</p>
</dd>
</dl>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If <code class="xref py py-func docutils literal"><span class="pre">mdrun_d()</span></code> is not found, the function
falls back to <code class="xref py py-func docutils literal"><span class="pre">mdrun()</span></code> instead.</p>
</div>
</dd></dl>

<dl class="function">
<dt id="gromacs.setup.em_schedule">
<code class="descclassname">gromacs.setup.</code><code class="descname">em_schedule</code><span class="sig-paren">(</span><em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#gromacs.setup.em_schedule" title="Permalink to this definition">¶</a></dt>
<dd><p>Run multiple energy minimizations one after each other.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Keywords:</th><td class="field-body"><dl class="first docutils">
<dt><em>integrators</em></dt>
<dd><p class="first last">list of integrators (from &#8216;l-bfgs&#8217;, &#8216;cg&#8217;, &#8216;steep&#8217;)
[[&#8216;bfgs&#8217;, &#8216;steep&#8217;]]</p>
</dd>
<dt><em>nsteps</em></dt>
<dd><p class="first last">list of maximum number of steps; one for each integrator in
in the <em>integrators</em> list [[100,1000]]</p>
</dd>
<dt><em>kwargs</em></dt>
<dd><p class="first last">mostly passed to <a class="reference internal" href="#gromacs.setup.energy_minimize" title="gromacs.setup.energy_minimize"><code class="xref py py-func docutils literal"><span class="pre">gromacs.setup.energy_minimize()</span></code></a></p>
</dd>
</dl>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">dictionary with paths to final structure (&#8216;struct&#8217;) and
other files</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Example:</th><td class="field-body"><dl class="first docutils">
<dt>Conduct three minimizations:</dt>
<dd><ol class="first last arabic simple">
<li>low memory Broyden-Goldfarb-Fletcher-Shannon (BFGS) for 30 steps</li>
<li>steepest descent for 200 steps</li>
<li>finish with BFGS for another 30 steps</li>
</ol>
</dd>
</dl>
<p>We also do a multi-processor minimization when possible (i.e. for steep
(and conjugate gradient) by using a <a class="reference internal" href="simulation.html#gromacs.run.MDrunner" title="gromacs.run.MDrunner"><code class="xref py py-class docutils literal"><span class="pre">gromacs.run.MDrunner</span></code></a> class
for a <strong class="program">mdrun</strong> executable compiled for OpenMP in 64 bit (see
<a class="reference internal" href="simulation.html#module-gromacs.run" title="gromacs.run"><code class="xref py py-mod docutils literal"><span class="pre">gromacs.run</span></code></a> for details):</p>
<div class="last highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">gromacs.run</span>
<span class="n">gromacs</span><span class="o">.</span><span class="n">setup</span><span class="o">.</span><span class="n">em_schedule</span><span class="p">(</span><span class="n">struct</span><span class="o">=</span><span class="s1">&#39;solvate/ionized.gro&#39;</span><span class="p">,</span>
          <span class="n">mdrunner</span><span class="o">=</span><span class="n">gromacs</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">MDrunnerOpenMP64</span><span class="p">,</span>
          <span class="n">integrators</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;l-bfgs&#39;</span><span class="p">,</span> <span class="s1">&#39;steep&#39;</span><span class="p">,</span> <span class="s1">&#39;l-bfgs&#39;</span><span class="p">],</span>
          <span class="n">nsteps</span><span class="o">=</span><span class="p">[</span><span class="mi">50</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span> <span class="mi">50</span><span class="p">])</span>
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You might have to prepare the mdp file carefully because at the
moment one can only modify the <em>nsteps</em> parameter on a
per-minimizer basis.</p>
</div>
</dd></dl>

<dl class="function">
<dt id="gromacs.setup.MD_restrained">
<code class="descclassname">gromacs.setup.</code><code class="descname">MD_restrained</code><span class="sig-paren">(</span><em>dirname='MD_POSRES'</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#gromacs.setup.MD_restrained" title="Permalink to this definition">¶</a></dt>
<dd><p>Set up MD with position restraints.</p>
<p>Additional itp files should be in the same directory as the top file.</p>
<p>Many of the keyword arguments below already have sensible values. Note that
setting <em>mainselection</em> = <code class="docutils literal"><span class="pre">None</span></code> will disable many of the automated
choices and is often recommended when using your own mdp file.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Keywords:</th><td class="field-body"><dl class="first docutils">
<dt><em>dirname</em></dt>
<dd><p class="first last">set up under directory dirname [MD_POSRES]</p>
</dd>
<dt><em>struct</em></dt>
<dd><p class="first last">input structure (gro, pdb, ...) [em/em.pdb]</p>
</dd>
<dt><em>top</em></dt>
<dd><p class="first last">topology file [top/system.top]</p>
</dd>
<dt><em>mdp</em></dt>
<dd><p class="first last">mdp file (or use the template) [templates/md.mdp]</p>
</dd>
<dt><em>ndx</em></dt>
<dd><p class="first last">index file (supply when using a custom mdp)</p>
</dd>
<dt><em>includes</em></dt>
<dd><p class="first last">additional directories to search for itp files</p>
</dd>
<dt><em>mainselection</em></dt>
<dd><p class="first last"><strong class="program">make_ndx</strong> selection to select main group [&#8220;Protein&#8221;]
(If <code class="docutils literal"><span class="pre">None</span></code> then no canonical index file is generated and
it is the user&#8217;s responsibility to set <em>tc_grps</em>,
<em>tau_t</em>, and <em>ref_t</em> as keyword arguments, or provide the mdp template
with all parameter pre-set in <em>mdp</em> and probably also your own <em>ndx</em>
index file.)</p>
</dd>
<dt><em>deffnm</em></dt>
<dd><p class="first last">default filename for Gromacs run [md]</p>
</dd>
<dt><em>runtime</em></dt>
<dd><p class="first last">total length of the simulation in ps [1000]</p>
</dd>
<dt><em>dt</em></dt>
<dd><p class="first last">integration time step in ps [0.002]</p>
</dd>
<dt><em>qscript</em></dt>
<dd><p class="first last">script to submit to the queuing system; by default
uses the template <a class="reference internal" href="../core/config.html#gromacs.config.qscript_template" title="gromacs.config.qscript_template"><code class="xref py py-data docutils literal"><span class="pre">gromacs.config.qscript_template</span></code></a>, which can
be manually set to another template from <a class="reference internal" href="../core/config.html#gromacs.config.templates" title="gromacs.config.templates"><code class="xref py py-data docutils literal"><span class="pre">gromacs.config.templates</span></code></a>;
can also be a list of template names.</p>
</dd>
<dt><em>qname</em></dt>
<dd><p class="first last">name to be used for the job in the queuing system [PR_GMX]</p>
</dd>
<dt><em>mdrun_opts</em></dt>
<dd><p class="first last">option flags for the <strong class="program">mdrun</strong> command in the queuing system
scripts such as &#8220;-stepout 100&#8221;. [&#8220;&#8221;]</p>
</dd>
<dt><em>kwargs</em></dt>
<dd><p class="first">remaining key/value pairs that should be changed in the template mdp
file, eg <code class="docutils literal"><span class="pre">nstxtcout=250,</span> <span class="pre">nstfout=250</span></code> or command line options for
<code class="docutils literal"><span class="pre">grompp`</span> <span class="pre">such</span> <span class="pre">as</span> <span class="pre">``maxwarn=1</span></code>.</p>
<p>In particular one can also set <strong>define</strong> and activate
whichever position restraints have been coded into the itp
and top file. For instance one could have</p>
<blockquote>
<div><p><em>define</em> = &#8220;-DPOSRES_MainChain -DPOSRES_LIGAND&#8221;</p>
</div></blockquote>
<p>if these preprocessor constructs exist. Note that there
<strong>must not be any space between &#8220;-D&#8221; and the value.</strong></p>
<p class="last">By default <em>define</em> is set to &#8220;-DPOSRES&#8221;.</p>
</dd>
</dl>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">a dict that can be fed into <a class="reference internal" href="#gromacs.setup.MD" title="gromacs.setup.MD"><code class="xref py py-func docutils literal"><span class="pre">gromacs.setup.MD()</span></code></a>
(but check, just in case, especially if you want to
change the <code class="docutils literal"><span class="pre">define</span></code> parameter in the mdp file)</p>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The output frequency is drastically reduced for position
restraint runs by default. Set the corresponding <code class="docutils literal"><span class="pre">nst*</span></code>
variables if you require more output. The <a class="reference external" href="http://manual.gromacs.org/online/mdp_opt.html#pc">pressure coupling</a>
option <em>refcoord_scaling</em> is set to &#8220;com&#8221; by default (but can
be changed via <em>kwargs</em>) and the pressure coupling
algorithm itself is set to <em>Pcoupl</em> = &#8220;Berendsen&#8221; to
run a stable simulation.</p>
</div>
</dd></dl>

<dl class="function">
<dt id="gromacs.setup.MD">
<code class="descclassname">gromacs.setup.</code><code class="descname">MD</code><span class="sig-paren">(</span><em>dirname='MD'</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#gromacs.setup.MD" title="Permalink to this definition">¶</a></dt>
<dd><p>Set up equilibrium MD.</p>
<p>Additional itp files should be in the same directory as the top file.</p>
<p>Many of the keyword arguments below already have sensible values. Note that
setting <em>mainselection</em> = <code class="docutils literal"><span class="pre">None</span></code> will disable many of the automated
choices and is often recommended when using your own mdp file.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Keywords:</th><td class="field-body"><dl class="first docutils">
<dt><em>dirname</em></dt>
<dd><p class="first last">set up under directory dirname [MD]</p>
</dd>
<dt><em>struct</em></dt>
<dd><p class="first last">input structure (gro, pdb, ...) [MD_POSRES/md_posres.pdb]</p>
</dd>
<dt><em>top</em></dt>
<dd><p class="first last">topology file [top/system.top]</p>
</dd>
<dt><em>mdp</em></dt>
<dd><p class="first last">mdp file (or use the template) [templates/md.mdp]</p>
</dd>
<dt><em>ndx</em></dt>
<dd><p class="first last">index file (supply when using a custom mdp)</p>
</dd>
<dt><em>includes</em></dt>
<dd><p class="first last">additional directories to search for itp files</p>
</dd>
<dt><em>mainselection</em></dt>
<dd><p class="first last"><code class="docutils literal"><span class="pre">make_ndx</span></code> selection to select main group [&#8220;Protein&#8221;]
(If <code class="docutils literal"><span class="pre">None</span></code> then no canonical index file is generated and
it is the user&#8217;s responsibility to set <em>tc_grps</em>,
<em>tau_t</em>, and <em>ref_t</em> as keyword arguments, or provide the mdp template
with all parameter pre-set in <em>mdp</em> and probably also your own <em>ndx</em>
index file.)</p>
</dd>
<dt><em>deffnm</em></dt>
<dd><p class="first last">default filename for Gromacs run [md]</p>
</dd>
<dt><em>runtime</em></dt>
<dd><p class="first last">total length of the simulation in ps [1000]</p>
</dd>
<dt><em>dt</em></dt>
<dd><p class="first last">integration time step in ps [0.002]</p>
</dd>
<dt><em>qscript</em></dt>
<dd><p class="first last">script to submit to the queuing system; by default
uses the template <a class="reference internal" href="../core/config.html#gromacs.config.qscript_template" title="gromacs.config.qscript_template"><code class="xref py py-data docutils literal"><span class="pre">gromacs.config.qscript_template</span></code></a>, which can
be manually set to another template from <a class="reference internal" href="../core/config.html#gromacs.config.templates" title="gromacs.config.templates"><code class="xref py py-data docutils literal"><span class="pre">gromacs.config.templates</span></code></a>;
can also be a list of template names.</p>
</dd>
<dt><em>qname</em></dt>
<dd><p class="first last">name to be used for the job in the queuing system [MD_GMX]</p>
</dd>
<dt><em>mdrun_opts</em></dt>
<dd><p class="first last">option flags for the <strong class="program">mdrun</strong> command in the queuing system
scripts such as &#8220;-stepout 100 -dgdl&#8221;. [&#8220;&#8221;]</p>
</dd>
<dt><em>kwargs</em></dt>
<dd><p class="first last">remaining key/value pairs that should be changed in the template mdp
file, e.g. <code class="docutils literal"><span class="pre">nstxtcout=250,</span> <span class="pre">nstfout=250</span></code> or command line options for
:program`grompp` such as <code class="docutils literal"><span class="pre">maxwarn=1</span></code>.</p>
</dd>
</dl>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">a dict that can be fed into <a class="reference internal" href="#gromacs.setup.MD" title="gromacs.setup.MD"><code class="xref py py-func docutils literal"><span class="pre">gromacs.setup.MD()</span></code></a>
(but check, just in case, especially if you want to
change the <em>define</em> parameter in the mdp file)</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="helper-functions">
<h2>Helper functions<a class="headerlink" href="#helper-functions" title="Permalink to this headline">¶</a></h2>
<p>The following functions are used under the hood and are mainly useful when
writing extensions to the module.</p>
<dl class="function">
<dt id="gromacs.setup.make_main_index">
<code class="descclassname">gromacs.setup.</code><code class="descname">make_main_index</code><span class="sig-paren">(</span><em>struct</em>, <em>selection='&quot;Protein&quot;'</em>, <em>ndx='main.ndx'</em>, <em>oldndx=None</em><span class="sig-paren">)</span><a class="headerlink" href="#gromacs.setup.make_main_index" title="Permalink to this definition">¶</a></dt>
<dd><p>Make index file with the special groups.</p>
<p>This routine adds the group __main__ and the group __environment__
to the end of the index file. __main__ contains what the user
defines as the <em>central</em> and <em>most important</em> parts of the
system. __environment__ is everything else.</p>
<p>The template mdp file, for instance, uses these two groups for T-coupling.</p>
<p>These groups are mainly useful if the default groups &#8220;Protein&#8221; and &#8220;Non-Protein&#8221;
are not appropriate. By using symbolic names such as __main__ one
can keep scripts more general.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><em>groups</em> is a list of dictionaries that describe the index groups. See
<a class="reference internal" href="cbook.html#gromacs.cbook.parse_ndxlist" title="gromacs.cbook.parse_ndxlist"><code class="xref py py-func docutils literal"><span class="pre">gromacs.cbook.parse_ndxlist()</span></code></a> for details.</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Arguments:</th><td class="field-body"><dl class="first last docutils">
<dt><em>struct</em></dt>
 <span class="classifier-delimiter">:</span> <span class="classifier">filename</span><dd><p class="first last">structure (tpr, pdb, gro)</p>
</dd>
<dt><em>selection</em></dt>
 <span class="classifier-delimiter">:</span> <span class="classifier">string</span><dd><p class="first last">is a <code class="docutils literal"><span class="pre">make_ndx</span></code> command such as <code class="docutils literal"><span class="pre">&quot;Protein&quot;</span></code> or <code class="docutils literal"><span class="pre">r</span> <span class="pre">DRG</span></code> which
determines what is considered the main group for centering etc. It is
passed directly to <code class="docutils literal"><span class="pre">make_ndx</span></code>.</p>
</dd>
<dt><em>ndx</em></dt>
 <span class="classifier-delimiter">:</span> <span class="classifier">string</span><dd><p class="first last">name of the final index file</p>
</dd>
<dt><em>oldndx</em></dt>
 <span class="classifier-delimiter">:</span> <span class="classifier">string</span><dd><p class="first last">name of index file that should be used as a basis; if None
then the <code class="docutils literal"><span class="pre">make_ndx</span></code> default groups are used.</p>
</dd>
</dl>
</td>
</tr>
</tbody>
</table>
<p>This routine is very dumb at the moment; maybe some heuristics will be
added later as could be other symbolic groups such as __membrane__.</p>
</dd></dl>

<dl class="function">
<dt id="gromacs.setup.check_mdpargs">
<code class="descclassname">gromacs.setup.</code><code class="descname">check_mdpargs</code><span class="sig-paren">(</span><em>d</em><span class="sig-paren">)</span><a class="headerlink" href="#gromacs.setup.check_mdpargs" title="Permalink to this definition">¶</a></dt>
<dd><p>Check if any arguments remain in dict <em>d</em>.</p>
</dd></dl>

<dl class="function">
<dt id="gromacs.setup.get_lipid_vdwradii">
<code class="descclassname">gromacs.setup.</code><code class="descname">get_lipid_vdwradii</code><span class="sig-paren">(</span><em>outdir='.'</em>, <em>libdir=None</em><span class="sig-paren">)</span><a class="headerlink" href="#gromacs.setup.get_lipid_vdwradii" title="Permalink to this definition">¶</a></dt>
<dd><p>Find vdwradii.dat and add special entries for lipids.</p>
<p>See <a class="reference internal" href="#gromacs.setup.vdw_lipid_resnames" title="gromacs.setup.vdw_lipid_resnames"><code class="xref py py-data docutils literal"><span class="pre">gromacs.setup.vdw_lipid_resnames</span></code></a> for lipid
resnames. Add more if necessary.</p>
</dd></dl>

<dl class="function">
<dt id="gromacs.setup._setup_MD">
<code class="descclassname">gromacs.setup.</code><code class="descname">_setup_MD</code><span class="sig-paren">(</span><em>dirname</em>, <em>deffnm='md'</em>, <em>mdp='/Volumes/Data/oliver/Biop/Projects/Methods/GromacsWrapper/gromacs/templates/md_OPLSAA.mdp'</em>, <em>struct=None</em>, <em>top='top/system.top'</em>, <em>ndx=None</em>, <em>mainselection='&quot;Protein&quot;'</em>, <em>qscript='/Volumes/Data/oliver/Biop/Projects/Methods/GromacsWrapper/gromacs/templates/local.sh'</em>, <em>qname=None</em>, <em>startdir=None</em>, <em>mdrun_opts=''</em>, <em>budget=None</em>, <em>walltime=0.3333333333333333</em>, <em>dt=0.002</em>, <em>runtime=1000.0</em>, <em>**mdp_kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#gromacs.setup._setup_MD" title="Permalink to this definition">¶</a></dt>
<dd><p>Generic function to set up a <code class="docutils literal"><span class="pre">mdrun</span></code> MD simulation.</p>
<p>See the user functions for usage.</p>
</dd></dl>

<p>Defined constants:</p>
<dl class="data">
<dt id="gromacs.setup.CONC_WATER">
<code class="descclassname">gromacs.setup.</code><code class="descname">CONC_WATER</code><em class="property"> = 55.345</em><a class="headerlink" href="#gromacs.setup.CONC_WATER" title="Permalink to this definition">¶</a></dt>
<dd><p>Concentration of water at standard conditions in mol/L.
Density at 25 degrees C and 1 atmosphere pressure: rho = 997.0480 g/L.
Molecular weight: M = 18.015 g/mol.
c = n/V = m/(V*M) = rho/M  = 55.345 mol/L.</p>
</dd></dl>

<dl class="data">
<dt id="gromacs.setup.vdw_lipid_resnames">
<code class="descclassname">gromacs.setup.</code><code class="descname">vdw_lipid_resnames</code><em class="property"> = ['POPC', 'POPE', 'POPG', 'DOPC', 'DPPC', 'DLPC', 'DMPC', 'DPPG']</em><a class="headerlink" href="#gromacs.setup.vdw_lipid_resnames" title="Permalink to this definition">¶</a></dt>
<dd><p>Hard-coded lipid residue names for a <code class="docutils literal"><span class="pre">vdwradii.dat</span></code> file. Use together with
<a class="reference internal" href="#gromacs.setup.vdw_lipid_atom_radii" title="gromacs.setup.vdw_lipid_atom_radii"><code class="xref py py-data docutils literal"><span class="pre">vdw_lipid_atom_radii</span></code></a> in <a class="reference internal" href="#gromacs.setup.get_lipid_vdwradii" title="gromacs.setup.get_lipid_vdwradii"><code class="xref py py-func docutils literal"><span class="pre">get_lipid_vdwradii()</span></code></a>.</p>
</dd></dl>

<dl class="data">
<dt id="gromacs.setup.vdw_lipid_atom_radii">
<code class="descclassname">gromacs.setup.</code><code class="descname">vdw_lipid_atom_radii</code><em class="property"> = {'H': 0.09, 'C': 0.25, 'O': 0.155, 'N': 0.16}</em><a class="headerlink" href="#gromacs.setup.vdw_lipid_atom_radii" title="Permalink to this definition">¶</a></dt>
<dd><p>Increased atom radii for lipid atoms; these are simply the standard values from
<code class="docutils literal"><span class="pre">GMXLIB/vdwradii.dat</span></code> increased by 0.1 nm (C) or 0.05 nm (N, O, H).</p>
</dd></dl>

</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="scaling.html" title="gromacs.scaling – Partial tempering"
             >next</a> |</li>
        <li class="right" >
          <a href="cbook.html" title="gromacs.cbook – Gromacs Cook Book"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">GromacsWrapper 0.6.1 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../gromacs.html" >GromacsWrapper package</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="../building_blocks.html" >Gromacs building blocks</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2009-2016, The Authors of GromacsWrapper (see AUTHORS).
      Last updated on Sep 16, 2016.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.1.
    </div>
  </body>
</html>