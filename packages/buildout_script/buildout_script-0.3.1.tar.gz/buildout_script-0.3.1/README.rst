===============
buildout_script
===============

:Author: Nathan R. Yergler <nathan@yergler.net>
:Copyright:
   2006-2015, Nathan R. Yergler, Creative Commons;
   licensed to the public under the `MIT license
   <http://opensource.org/licenses/mit-license.php>`_.

Overview
********

buildout_script is a `zc.buildout`_ recipe for generating scripts from
a template.  Unlike scripts specified by the ``console_scripts``
entry point, those generated by buildout_script are not restricted to
Python code.

Scripts are generated from templates and can include settings from the
buildout substituted at runtime.

One example usage is the generation of a wrapper script for `Paste
Script`_ to check the status of a
daemonized server process (see paster-check below).

Usage
*****

To use the buildout_script recipe, specify it as the recipe for a
zc.buildout part along with the ``template`` part.  For example::

  [sample_part]
  recipe = buildout_script
  template = paster-check.sh.in

The script will be created in the bin-directory.  You may also specify
the following parameters:

target
    The filename for the generated script; if omitted, the script will have
    the template filename without the extension.

template_dir
    An optional directory to look for templates in.  Default: ``templates``
    Templates included with the recipe may also be used without specifying
    a template_dir.

Templates
*********

Template variables should be formatted using the buildout convention
of ``${part-name:variable-name}``.

NB. Until version 0.2a1 of buildout_script the python `string formatting syntax`_ was used
where the dictionary for the formatting operation was a flattened dictionary of the
buildout settings and part settings.

For example, a trivial script template to list the files in the buildout
installation directory would look like this::

  #!/bin/bash

  # Sample buildout_script script template
  ls ${buildout:directory}

buildout_script ships with one script template, ``paster-check.sh.in``,
described below.  Additional template contributions are welcome.

paster-check.sh.in
==================

At Creative Commons we used `Paste Script`_ as the server for simple
web applications.  We run them using the ``--daemon`` flag, but
occassionally something goes awry and the process dies.  This template
generates a script which can be called periodically from cron to
ensure the process is still running.  Note that this script can also
be used to start the server if it is not already running.

Configuration Parameters
------------------------

Configuration parameters used by this script, which should be specified
as settings in the zc.buildout part:

server_cfg
  The `Paste Deploy <http://pythonpaste.org/deploy>`_ configuration
  file to serve.

pid_file
  The PID file to use when starting the server (and to subsequently check).

log_file
  The log file to use.

.. _`Paste Script`: http://pythonpaste.org/script/
.. _zc.buildout: http://cheeseshop.python.org/pypi/zc.buildout
.. _`string formatting syntax`: https://docs.python.org/2/library/stdtypes.html#string-formatting
