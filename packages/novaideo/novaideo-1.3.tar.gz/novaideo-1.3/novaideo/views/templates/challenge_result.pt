<div class="thumbnail right-caption span4 search-item result-item view-item component-obj-view component-listing-view"
     id="listing_${oid}"
     data-component_type="object-view"
     i18n:domain="novaideo"
     tal:define="url request.resource_url(object, '@@index');
                 icon getattr(object, 'icon');
                 author object.author;
                 files object.get_all_attached_files_data();
                 len_files len(files);
                 oid object.__oid__;
                 deadline getattr(object, 'deadline', None);
                 expired object.is_expired;
                 is_restricted getattr(object, 'is_restricted', False)
                 ">
  <div class="media-body media-challenge" tal:define="author_picture getattr(author, 'picture', None)">
    <div class="author-block">
      <img class="author-img img-circle" 
         tal:condition="author_picture is not None" 
         tal:attributes="src getattr(author_picture, 'profil', author_picture).url"  width="35"/>
      <img class="author-img img-circle" tal:condition="author_picture is None" src="${request.static_url('novaideo:static/images/user100.png')}" width="35"/>
      <small>
        <span i18n:translate="">Submitted by</span>
        <a tal:attributes="href request.resource_url(author, '@@index')"
          data-oid="${getattr(author, '__oid__', '')}"
          class="toggle-popover">
          ${((author is current_user) and 'Vous') or getattr(author, 'title', author.name)}
        </a>
        <span i18n:translate="">the</span>
        <span tal:replace="layout.to_localized_time(object.created_at)"/>
      </small>
    </div>
    <div class="support-col">
    </div>

    <div class="content-col">
      <div class="object-title-block view-item-title"
        data-title="${object.title}"
        data-icon="${icon}"
        data-img="">
        <div class="object-menu pull-right">
          <div tal:replace="structure menu_body"/>
        </div>
        <a tal:attributes="href url">
          <h4>
            <span class="icon ${icon}"></span>  ${object.title}
            <span tal:condition="state" class="label label-basic" i18n:translate="" tal:content="state"/>
          </h4>
        </a>
      </div>
      <div tal:condition="deadline or is_restricted" class="challenge-status">
        <div tal:omit-tag="" tal:condition="deadline">
          <small class="deadline-text-challenge deadline-text-danger" tal:condition="expired">
            <span class="glyphicon glyphicon-calendar"></span> <span i18n:translate="">The challenge is expired</span>
          </small>
          <small class="deadline-text-challenge deadline-text-success" tal:condition="not expired">
            <span class="glyphicon glyphicon-calendar"></span> <span i18n:translate=""><span i18n:name="days" >${object.remaining_duration}</span> day(s) before the end of the challenge.</span>
          </small>
        </div>
        <small tal:condition="is_restricted" class="restricted">
          <span class="ion-locked"></span> <span i18n:translate="">This challenge is restricted</span>
        </small>
      </div>
      <div class="keywords-result">
        <span class="glyphicon glyphicon-tags"></span> 
        <tal:loop repeat="k object.keywords">
              <a tal:attributes="href request.resource_url(request.root, 'search', query={'text_to_search':k})">${k}</a><tal:separator condition="not: repeat['k'].end">, </tal:separator> 
        </tal:loop>
      </div>

      <div class="row object-row-content">
        <div class="col col-xs-12 ${files and 'col-md-8' or 'col-md-12'}">
          <div class="object-text">${structure:object.presentation_text(500)}</div>
        </div>
        <div class="col col-xs-12 col-md-4" tal:condition="files">
            <div class="file-slider">
              <div id="filecarousel${oid}" data-ride="carousel" data-interval="3000" class="carousel slide"> 
                <div role="listbox" class="carousel-inner">
                      <div tal:repeat="(i, source) enumerate(files)" class="item ${i==0 and 'active'}">
                         <a tal:condition="source['type'] == 'img'" href="${source['content']}" target="_blank">
                           <div 
                            class="img-content"
                            data-holder-rendered="true"
                            style="
                              background: rgba(0, 0, 0, 0) url(${source['content']}) no-repeat scroll center center / cover">
                           </div>
                         </a>
                         <object tal:condition="source['type'] == 'flash'" width="300" height="90" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=11,2,202,451" >
                          <param name="movie" value="${source['content']}">
                          <param name="quality" value="high">
                          <embed src="${source['content']}" quality="high" class="img-content" 
                            type="application/x-shockwave-flash" 
                                      pluginspage="http://www.macromedia.com/go/getflashplayer">
                          </embed>
                         </object>
                      </div>
                </div>
                <div tal:omit-tag="" tal:condition="len_files>1">
                  <a class="left carousel-control" href="#filecarousel${oid}" role="button" data-slide="prev">
                    <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
                    <span class="sr-only">Previous</span>
                  </a>
                  <a class="right carousel-control" href="#filecarousel${oid}" role="button" data-slide="next">
                    <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
                    <span class="sr-only">Next</span>
                  </a>
                </div>
              </div>
         </div>
        </div>
      </div>
    </div>

    <div class="search-item-footer">
      <div class="actions-block">
        <div tal:replace="structure footer_body"/>
      </div>
      <div class="footer-actions-bodies">
        <div tal:repeat="a footer_actions_body" >
          <div tal:replace="structure a"/>
        </div>
      </div>
    </div>
  </div>
  <div class="action-interation-container action-slider-container"
         data-interaction_kind="slider">
      <button class="btn btn-primary action-slider-btn"><span class="glyphicon glyphicon-chevron-right"></span></button>
      <div class="container-body">
      </div>
  </div>
</div>