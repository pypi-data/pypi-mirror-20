{% load squad %}

{% if comparison %}
<table class='table table-bordered test-results'>
  <tr>
    <td rowspan='2'></td>
    {% for build, test_runs in comparison.test_runs.items %}
    <th colspan={{test_runs|length}}>
      <a href="{% project_url build %}">{{build.project}}, build {{build.version}}</a>
    </th>
    {% endfor %}
  </tr>
  <tr>
    {% for build, test_runs in comparison.test_runs.items %}
      {% for test_run in test_runs %}
      <th>
        <a href="{% project_url test_run %}">{{test_run.environment.slug}}</a>
      </th>
      {% endfor %}
    {% endfor %}
  </tr>
  {% for test, results in comparison.results.items %}
    <tr>
      <th>{{test}}</th>
      {% for build, test_runs in comparison.test_runs.items %}
        {% for test_run in test_runs %}
          {% with result=results|get_value:test_run %}
            <td class='{{result}}'>
              {% if result %}
              <a href="{% url 'test_history' build.project.group.slug build.project.slug test %}">
                <strong>{{result}}</strong>
              </a>
              {% else %}
              <i>n/a</i>
              {% endif %}
            </td>
          {% endwith %}
        {% endfor %}
      {% endfor %}
    </tr>
  {% endfor %}
</table>
{% endif %}
