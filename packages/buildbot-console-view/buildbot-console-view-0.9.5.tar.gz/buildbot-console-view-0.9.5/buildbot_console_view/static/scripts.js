BOWERDEPS="undefined"==typeof BOWERDEPS?{}:BOWERDEPS,function(){var i,e,t,l=function(i,e){return function(){return i.apply(e,arguments)}};i=function(){function i(){return["ui.router","ui.bootstrap","common","ngAnimate","guanlecoja.ui","bbData"]}return i}(),t=function(){function i(i,e){var t,l,n;l="console",e.addGroup({name:l,caption:"Console View",icon:"exclamation-circle",order:5}),t={group:l,caption:"Console View"},n={controller:l+"Controller",controllerAs:"c",templateUrl:"console_view/views/"+l+".html",name:l,url:"/"+l,data:t},i.state(n)}return i}(),e=function(){function i(i,e,t,n){this.$scope=i,this.$window=t,this.matchBuildWithChange=l(this.matchBuildWithChange,this),this.onChange=l(this.onChange,this),this.buildLimit=200,this.changeLimit=10,this.dataAccessor=n.open().closeOnDestroy(this.$scope),this.$scope.builders=this.builders=this.dataAccessor.getBuilders(),this.$scope.builders.queryExecutor.isFiltered=function(i){return null==i.masterids||i.masterids.length>0},this.$scope.builds=this.builds=this.dataAccessor.getBuilds({limit:this.buildLimit,order:"-complete_at"}),this.changes=this.dataAccessor.getChanges({limit:this.changeLimit,order:"-changeid"}),this.buildrequests=this.dataAccessor.getBuildrequests({limit:this.buildLimit,order:"-submitted_at"}),this.buildsets=this.dataAccessor.getBuildsets({limit:this.buildLimit,order:"-submitted_at"}),this.loading=!0,this.builds.onChange=this.changes.onChange=this.buildrequests.onChange=this.buildsets.onChange=this.onChange}return i.prototype.onChange=function(i){var e,t,l,n,s,r,o,a,c,d,h,u,g,b,f,p,m,v,w;if(0!==this.builds.length&&0!==this.builders.length&&0!==this.changes.length&&0!==this.buildsets.length&&0!==this.buildrequests){for(this.changesBySSID={},f=this.changes,s=0,c=f.length;c>s;s++)for(n=f[s],this.changesBySSID[n.sourcestamp.ssid]=n,n.builders=[],n.buildersById={},p=this.builders,r=0,d=p.length;d>r;r++)l=p[r],l={builderid:l.builderid,name:l.name,builds:[]},n.builders.push(l),n.buildersById[l.builderid]=l;for(m=this.builds,o=0,h=m.length;h>o;o++)t=m[o],this.matchBuildWithChange(t);for(v=this.changes,a=0,u=v.length;u>a;a++)for(n=v[a],n.maxbuilds=1,w=n.builders,b=0,g=w.length;g>b;b++)l=w[b],e=l.builds,e.length>n.maxbuilds&&(n.maxbuilds=e.length);return this.setWidth(this.$window.innerWidth),angular.element(this.$window).bind("resize",function(i){return function(){return i.setWidth(i.$window.innerWidth),i.$scope.$apply()}}(this)),this.loading=!1}},i.prototype.matchBuildWithChange=function(i){var e,t,l,n,s,r,o,a;if(e=this.buildrequests.get(i.buildrequestid),null!=e&&(t=this.buildsets.get(e.buildsetid),null!=t&&null!=t.sourcestamps)){for(r=t.sourcestamps,o=[],n=0,s=r.length;s>n;n++)a=r[n],l=this.changesBySSID[a.ssid],null!=l?o.push(l.buildersById[i.builderid].builds.push(i)):o.push(void 0);return o}},i.prototype.setWidth=function(i){return this.cellWidth=100/this.builders.length+"%",.85*i/this.builders.length>40?this.width="100%":this.width=40*this.builders.length/.85+"px"},i.prototype.openAll=function(){return this.$scope.$broadcast("showAllInfo",!1)},i.prototype.closeAll=function(){return this.$scope.$broadcast("showAllInfo",!0)},i}(),angular.module("console_view",new i).config(["$stateProvider","glMenuServiceProvider",t]).controller("consoleController",["$scope","$q","$window","dataService",e])}.call(this),function(){var i,e;i=function(){function i(){return{replace:!0,restrict:"EA",scope:{width:"=",cellWidth:"=",builders:"=?"},templateUrl:"console_view/views/buildersheader.html",controller:"_buildersHeaderController",controllerAs:"bh"}}return i}(),e=function(){function i(i){i.$watch("width",function(i){return function(e){i.width=e}}(this)),i.$watch("cellWidth",function(i){return function(e){i.cellWidth=e}}(this)),i.$watchCollection("builders",function(i){return function(e){i.builders=e}}(this))}return i}(),angular.module("console_view").directive("buildersHeader",[i]).controller("_buildersHeaderController",["$scope",e])}.call(this),function(){var i,e;i=function(){function i(){return{replace:!1,restrict:"EA",scope:{width:"=",cellWidth:"=",change:"=?"},templateUrl:"console_view/views/changerow.html",controller:"_changeRowController",controllerAs:"cr"}}return i}(),e=function(){function i(i,e,t){this.$uibModal=t,angular.extend(this,e),this.infoIsCollapsed=!0,i.$on("showAllInfo",function(i){return function(e,t){return i.infoIsCollapsed=t}}(this)),i.$watch("width",function(i){return function(e){i.width=e}}(this)),i.$watch("cellWidth",function(i){return function(e){i.cellWidth=e}}(this)),i.$watch("change",function(i){return function(e){return i.change=e,i.change&&angular.isString(i.change.repository)?i.createLink():void 0}}(this))}return i.prototype.createLink=function(){var i;return i=this.change.repository.replace(".git",""),this.change.link=i+"/commit/"+this.change.revision},i.prototype.selectBuild=function(i){var e;return e=this.$uibModal.open({templateUrl:"console_view/views/modal.html",controller:"consoleModalController as modal",windowClass:"modal-small",resolve:{selectedBuild:function(){return i}}})},i.prototype.createFileLink=function(i){var e;return e=this.change.repository.replace(".git",""),e+"/blob/"+this.change.revision+"/"+i},i.prototype.toggleInfo=function(){return this.infoIsCollapsed=!this.infoIsCollapsed},i}(),angular.module("console_view").directive("changeRow",[i]).controller("_changeRowController",["$scope","resultsService","$uibModal",e])}.call(this),function(){var i;i=function(){function i(i,e,t){this.$uibModalInstance=e,this.selectedBuild=t,i.$on("$stateChangeStart",function(i){return function(){return i.close()}}(this))}return i.prototype.close=function(){return this.$uibModalInstance.close()},i}(),angular.module("console_view").controller("consoleModalController",["$scope","$uibModalInstance","selectedBuild",i])}.call(this),angular.module("console_view").run(["$templateCache",function(i){i.put("console_view/views/console.html",'<div class="console"><div class="load-indicator" ng-show="c.loading"><div class="spinner"><i class="fa fa-circle-o-notch fa-spin fa-2x"></i><p>loading</p></div></div><div class="header"><div class="header-content" ng-style="{width: c.width}"><div class="col-15"><div class="buttons"><i class="fa fa-plus-circle" ng-click="c.openAll()" uib-tooltip="Open information for all changes" uib-tooltip-placement="right"></i><i class="fa fa-minus-circle" ng-click="c.closeAll()" uib-tooltip="Close information for all changes" uib-tooltip-placement="right"></i></div><div class="search-field"><input type="text" name="search" ng-model="search" placeholder="search"/></div></div><div class="col-85"><builders-header builders="c.builders" width="c.width" cell-width="c.cellWidth"></builders-header></div></div></div><div class="content"><div class="change-rows" ng-style="{width: c.width}"><change-row ng-repeat="change in c.changes | filter: search | orderBy: [\'changeid\'] track by change.changeid" change="change" width="c.width" cell-width="c.cellWidth"></change-row></div></div></div>'),i.put("console_view/views/buildersheader.html",'<div class="builders"><a class="builder" ng-repeat="builder in bh.builders | orderBy: \'name\' track by builder.builderid" ng-style="{width: bh.cellWidth}" ng-href="#/builders/{{ builder.builderid }}" ng-bind="builder.name"></a></div>'),i.put("console_view/views/changerow.html",'<div class="change-row" ng-style="{height: 10 + (cr.change.maxbuilds*20)}"><div class="col-15"><div class="name"><div class="change-avatar"><img ng-src="avatar?email={{cr.change.author_email}}"/></div><i class="fa fa-chevron-circle-right" ng-click="cr.toggleInfo()" ng-class="{\'fa-rotate-90\': !cr.infoIsCollapsed}"></i><span uib-tooltip="{{ cr.change.comments }}" uib-tooltip-placement="top"><a ng-if="cr.change.author_email" ng-href="mailto: {{cr.change.author_email}}" target="_blank"> {{ cr.change.author_name }}</a><span ng-if="!cr.change.author_email"> {{ cr.change.author }}</span></span></div></div><div class="col-85"><div class="builds"><span class="build" ng-repeat="builder in change.builders | orderBy: [\'name\'] track by builder.builderid" ng-style="{\'width\': cr.cellWidth}" title="{{builder.name}}"><a ng-repeat="build in builder.builds | orderBy: [\'started_at\']"><div class="badge-status" ng-if="build.buildid" ng-class="cr.results2class(build, \'pulse\')" ng-click="cr.selectBuild(build)">{{ build.number }}</div></a></span></div></div><div class="col info-collapse" ng-hide="cr.infoIsCollapsed"><!-- Comment--><div class="info"><i class="fa fa-comment-o"></i><p>{{ cr.change.comments }}</p></div><!-- Link to the change--><div class="info"><i class="fa fa-link"></i><p><a ng-href="{{ cr.change.link }}" target="_blank">{{ cr.change.revision | limitTo: 10 }}</a></p></div><!-- Changed files--><div class="info"><i class="fa fa-file-o"></i><p ng-repeat="file in cr.change.files"><a ng-href="{{ cr.createFileLink(file) }}" target="_blank">{{ file }}</a></p></div></div></div>'),i.put("console_view/views/modal.html",'<!-- Show build summary for the selected build in a modal window--><div class="modal-header"><i class="fa fa-times pull-right" ng-click="modal.close()"></i><h4 class="modal-title">Build summary</h4></div><div class="modal-body"><buildsummary ng-if="modal.selectedBuild" buildid="modal.selectedBuild.buildid"></buildsummary></div>')}]);